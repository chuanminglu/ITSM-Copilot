# ITSM系统需求提交优化 - 用户故事文档

> **📌 文档说明**: 本文档基于用户旅程分析和MVP功能范围，将优化需求转化为符合INVEST原则的用户故事，为开发团队提供清晰的需求描述和验收标准。
>
> **编写日期**: 2025年12月8日
> **项目约束**: 2人×10工作日，浏览器插件，无后端服务
> **INVEST原则**: Independent, Negotiable, Valuable, Estimable, Small, Testable

---

## 📋 第1章：用户故事清单概览

### 1.1 P0核心故事（必须完成）

| 编号   | 故事标题             | 优先级 | 估算(人天) | 所属功能模块    | 解决痛点        |
| ------ | -------------------- | ------ | ---------- | --------------- | --------------- |
| US-001 | 系统智能搜索与选择   | P0     | 2.0        | F8 系统智能搜索 | P1 系统选择错误 |
| US-002 | 系统选择信心度反馈   | P0     | 1.0        | F9 信心度反馈   | P1 系统选择错误 |
| US-003 | 智能模板推荐匹配场景 | P0     | 1.5        | F4 智能模板推荐 | P2 需求描述简单 |
| US-004 | 结构化引导填写需求   | P0     | 2.0        | F5 结构化引导   | P2 需求描述简单 |
| US-005 | 需求示例库降低门槛   | P0     | 1.5        | F6 需求示例库   | P2 需求描述简单 |
| US-006 | 实时完整性检测提示   | P0     | 2.0        | F1 实时检测     | P2 需求描述简单 |
| US-007 | 需求质量评分可视化   | P0     | 1.5        | F2 质量评分     | P2 需求描述简单 |
| US-008 | 提交前缺失警告预防   | P0     | 1.0        | F3 缺失警告     | P2 需求描述简单 |
| US-009 | 插件集成测试部署     | P0     | 2.0        | 集成测试        | -               |

**P0故事总计**: 14.5人天 ✅（符合16人天约束）

### 1.2 资源分配计划

| 阶段    | 时间 | 开发A任务                | 开发B任务                | 里程碑                   |
| ------- | ---- | ------------------------ | ------------------------ | ------------------------ |
| Day 2-3 | 2天  | US-001, US-002 (3人天)   | US-003, US-004 (3.5人天) | ✅ 系统选择+模板引导完成 |
| Day 4-5 | 2天  | US-006, US-007 (3.5人天) | US-005, US-008 (2.5人天) | ✅ 质量检测完成          |
| Day 6-8 | 3天  | US-009 集成测试 (2人天)  | US-009 集成测试 (2人天)  | ✅ MVP交付               |

### 1.3 故事价值地图

```
┌─────────────────────────────────────────────────────────────┐
│                   P1痛点：系统选择错误                        │
│                  （选错率40% → 目标10%）                      │
├─────────────────────────────────────────────────────────────┤
│  US-001                    US-002                           │
│  系统智能搜索与选择         信心度反馈                        │
│  （快速定位+直接选择）      （兜底方案）                       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                P2痛点：需求描述简单                           │
│            （澄清轮次2.5次 → 目标1次）                        │
├─────────────────────────────────────────────────────────────┤
│  US-003      US-004        US-005       US-006              │
│  智能模板    结构化引导    需求示例     实时检测              │
│  （场景匹配）（字段提示）  （降低门槛） （边写边改）          │
│                                                              │
│  US-007             US-008                                  │
│  质量评分           缺失警告                                 │
│  （建立信心）       （预防提交）                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 📖 第2章：用户故事详情

### 🎯 解决P1痛点：系统选择错误

---

## US-001：系统智能搜索与选择

### 故事描述

**As a** 业务部门主管（李经理），
**I want** 在侧边栏顶部的搜索框中输入关键词（如"CRM""客户""kehu"），实时从后台分类数据存储中检索系统并显示匹配结果列表，点击某个系统后自动在ITSM页面的系统下拉框中选择该系统，
**So that** 我能在1秒内找到目标系统并完成选择，而不用在ITSM页面的30多个选项中逐个浏览，选择时间从2分钟缩短到30秒。

### 故事背景

业务人员经常记不清系统的完整名称，只记得部分关键词或拼音首字母。如李经理想找"CRM系统"，但ITSM下拉框中显示的是"客户关系管理系统V2.0"，导致查找困难。需要通过智能搜索快速定位，并直接操作ITSM页面完成系统选择。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏实时搜索并显示结果

- **Given** 李经理打开ITSM页面，侧边栏自动展开
- **When** 在侧边栏顶部搜索框输入"CRM"
- **Then** 插件从后台分类数据存储（JSON配置文件）中检索匹配系统，侧边栏实时显示结果列表，只显示名称或关键词包含"CRM"的系统（如"CRM系统""客户关系管理系统V2.0"）

#### AC2：侧边栏支持拼音搜索

- **Given** 李经理记不清完整名称
- **When** 在侧边栏搜索框输入拼音"kehu"
- **Then** 插件使用拼音匹配算法从后台数据检索，侧边栏显示匹配拼音的系统（如"客户关系管理系统""客户服务平台"）

#### AC3：侧边栏支持模糊匹配

- **Given** 李经理在侧边栏搜索框输入"客户查"
- **When** 插件对搜索词进行分词并从后台数据检索，匹配系统名称包含"客户"和"查询"任一关键词
- **Then** 侧边栏显示相关系统（如"客户信息查询系统""客户数据平台"）

#### AC4：侧边栏无匹配结果提示

- **Given** 李经理在侧边栏搜索框输入了不存在的关键词"abcdefg"
- **When** 后台数据检索无匹配结果
- **Then** 侧边栏显示"未找到匹配系统，请尝试其他关键词"

#### AC5：点击搜索结果自动操作ITSM下拉框

- **Given** 李经理在侧边栏搜索到"客户关系管理系统V2.0"
- **When** 点击该系统名称
- **Then** 插件通过JavaScript自动在ITSM页面的"相关系统"下拉框中选择该系统（使用 `document.querySelector('#systemSelect').value = '客户关系管理系统V2.0'`并触发change事件），侧边栏显示"✅ 已选择：客户关系管理系统V2.0"

#### AC6：侧边栏搜索性能要求

- **Given** 李经理在侧边栏搜索框输入关键词
- **When** 每次输入一个字符
- **Then** 侧边栏系统列表在200ms内刷新（使用防抖优化）

### INVEST检查

| 原则                  | 检查项                                   | 状态 |
| --------------------- | ---------------------------------------- | ---- |
| **I**ndependent | 可独立开发，不依赖其他故事               | ✅   |
| **N**egotiable  | 搜索算法细节可协商（精确/模糊/拼音权重） | ✅   |
| **V**aluable    | 选择时间从2分钟→30秒，效率提升75%       | ✅   |
| **E**stimable   | 团队估算2人天                            | ✅   |
| **S**mall       | 2人天，可在2-3天内完成                   | ✅   |
| **T**estable    | 6条验收标准可转化为测试用例              | ✅   |

### 技术备注

- **后台数据存储**：系统分类数据存储在JSON配置文件中（可部署在服务器或插件本地），包含字段：系统ID、系统名称、分类、描述、关键词列表、拼音索引
- **搜索算法**：关键词分词 + 拼音首字母匹配 + 模糊匹配（使用Fuse.js或自实现）
- **拼音支持**：使用拼音转换库（如pinyin.js）生成拼音索引
- **性能优化**：使用防抖（debounce 200ms）优化搜索性能
- **ITSM页面操作**：使用Content Script注入JavaScript，通过DOM选择器定位"相关系统"下拉框（`#systemSelect`或其他选择器），设置value并触发change事件完成选择
- **数据示例**：
  ```json
  {
    "systems": [
      {
        "id": "sys001",
        "name": "客户关系管理系统V2.0",
        "category": "客户管理",
        "keywords": ["CRM", "客户", "关系", "管理"],
        "pinyin": ["kehu", "guanxi", "guanli", "CRM"]
      }
    ]
  }
  ```

### 估算

- **工时**: 2人天
- **负责开发**: 开发A
- **依赖**: 无

---

## US-002：系统选择信心度反馈

### 故事描述

**As a** 业务部门主管（李经理），
**I want** 在侧边栏通过搜索选择系统并操作ITSM下拉框后，侧边栏询问我"是否确定选择了正确的系统"（确定/不太确定/不确定），
**So that** 我可以表达不确定性，系统能在侧边栏提供帮助提示或推荐其他系统，消除"选错系统"的焦虑。

### 故事背景

李经理表示："即使通过智能搜索找到了系统，我还是不确定选对了没有，很担心被退回。"用户需要一个"兜底方案"来表达不确定性并获得帮助。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏选择系统后询问信心度

- **Given** 李经理在侧边栏点击"CRM系统"并填充到ITSM
- **When** 填充完成后
- **Then** 侧边栏底部显示信心度询问："您确定选择了正确的系统吗？ 确定 / 不太确定 / 不确定"

#### AC2：侧边栏选择"确定"正常继续

- **Given** 李经理在侧边栏点击"确定"
- **When** 确认信心度
- **Then** 侧边栏信心度询问消失，李经理在ITSM页面正常继续填写需求

#### AC3：侧边栏选择"不太确定"显示提示

- **Given** 李经理在侧边栏点击"不太确定"
- **When** 确认信心度
- **Then** 侧边栏显示帮助提示："该系统负责XXX功能，如需帮助可联系IT支持：内线1234"

#### AC4：侧边栏选择"不确定"提供备选

- **Given** 李经理在侧边栏点击"不确定"
- **When** 确认信心度
- **Then** 侧边栏显示"建议系统："并列出2-3个相似系统（可点击填充到ITSM），或显示"请联系IT支持协助选择"

#### AC5：记录信心度数据

- **Given** 李经理选择了任意信心度
- **When** 提交需求
- **Then** 信心度数据记录在LocalStorage，用于后续分析优化

### INVEST检查

| 原则                  | 检查项                                   | 状态 |
| --------------------- | ---------------------------------------- | ---- |
| **I**ndependent | 可独立开发，不依赖US-001和US-002         | ✅   |
| **N**egotiable  | 信心度选项文案和帮助提示内容可协商       | ✅   |
| **V**aluable    | 消除用户焦虑，提供兜底方案，提升用户信心 | ✅   |
| **E**stimable   | 团队估算1人天                            | ✅   |
| **S**mall       | 1人天，可在1天内完成                     | ✅   |
| **T**estable    | 5条验收标准可转化为测试用例              | ✅   |

### 技术备注

- 侧边栏信心度UI组件：单选按钮组（Radio Button Group）
- 系统帮助信息存储在配置文件：`{"CRM系统": {"职责": "客户关系管理", "联系人": "IT支持1234"}}`
- 信心度数据记录到LocalStorage：`{timestamp, system, confidence}`
- 如用户选择"不确定"，侧边栏显示备选系统列表，点击可重新填充ITSM表单

### 估算

- **工时**: 1人天
- **负责开发**: 开发B
- **依赖**: 无

---

### 🎯 解决P2痛点：需求描述简单

---

## US-003：智能模板推荐匹配场景

### 故事描述

**As a** 一线业务员（小王），
**I want** 在ITSM输入需求标题或描述时，侧边栏监听输入并自动识别场景，在侧边栏推荐合适的模板（Bug反馈/功能优化/新功能），
**So that** 我不用手动选择模板类型，侧边栏帮我匹配场景后点击使用，3秒内开始填写，节省思考时间。

### 故事背景

小王表示："我不知道该选哪个模板，Bug反馈、功能优化、新功能……这些分类让我很困惑。能不能系统自动帮我判断？"使用deepseek或qwen大模型进行场景识别。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏监听ITSM标题并推荐模板

- **Given** 小王在ITSM页面的需求标题输入"客户查询很慢"
- **When** 侧边栏监听到输入完成或焦点移至描述框
- **Then** 侧边栏自动显示推荐："💡 检测到Bug相关需求，已为您推荐'Bug反馈'模板。点击使用？"

#### AC2：侧边栏监听ITSM描述内容推荐模板

- **Given** 小王在ITSM页面描述框输入"希望增加导出Excel功能"
- **When** 侧边栏监听到输入20字以上
- **Then** 侧边栏自动推荐"新功能"模板

#### AC3：侧边栏支持手动切换模板

- **Given** 侧边栏推荐了"Bug反馈"模板
- **When** 小王在侧边栏点击"切换模板"按钮
- **Then** 侧边栏显示所有3个模板供选择，选择后立即切换

#### AC4：侧边栏显示推荐置信度

- **Given** 侧边栏推荐了某个模板
- **When** 推荐结果显示
- **Then** 侧边栏显示置信度（如"匹配度：85%"），让用户了解推荐可靠性

### INVEST检查

| 原则                  | 检查项                                   | 状态 |
| --------------------- | ---------------------------------------- | ---- |
| **I**ndependent | 可独立开发，不依赖其他故事               | ✅   |
| **N**egotiable  | 推荐算法和关键词库可协商                 | ✅   |
| **V**aluable    | 自动匹配场景，节省选择时间，降低认知负担 | ✅   |
| **E**stimable   | 团队估算1.5人天                          | ✅   |
| **S**mall       | 1.5人天，可在2天内完成                   | ✅   |
| **T**estable    | 4条验收标准可转化为测试用例              | ✅   |

### 技术备注

- 侧边栏使用MutationObserver监听ITSM页面输入框变化
- 调用deepseek或qwen大模型API进行场景识别
- 关键词映射表：`{"慢/卡/报错/闪退": "Bug反馈", "优化/改进/提升": "功能优化", "新增/增加/希望": "新功能"}`
- 推荐算法：关键词匹配（基础版）或AI语义理解（增强版）
- 侧边栏显示推荐卡片，点击"使用"后将模板结构化字段展开在侧边栏
- 置信度计算：匹配关键词数量/总关键词数

### 估算

- **工时**: 1.5人天
- **负责开发**: 开发B
- **依赖**: 无

---

## US-004：结构化引导填写需求

### 故事描述

**As a** 业务部门主管（李经理），
**I want** 在侧边栏选择模板后，侧边栏显示结构化的填写字段（背景/目标/场景/验收标准）和每个字段的引导问题，
**So that** 我在侧边栏填写完整内容后点击"填充到ITSM"，一键填充到ITSM描述框，不会遗漏关键信息，需求完整度从30%提卓80%。

### 故事背景

李经理表示："我不知道需求该写什么，给我一个空白框我只能写一句话。如果有提示告诉我该写背景、目标、场景，我就知道该写什么了。"使用deepseek或qwen大模型生成引导内容。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏显示结构化字段

- **Given** 李经理在侧边栏选择了"功能优化"模板
- **When** 模板加载完成
- **Then** 侧边栏显示4个必填字段：需求背景、优化目标、使用场景、验收标准

#### AC2：侧边栏字段引导问题

- **Given** 李经理将鼠标悬停在侧边栏"需求背景"字段
- **When** 悬停超1秒
- **Then** 侧边栏显示引导问题："为什么要做这个优化？当前遇到了什么问题？"

#### AC3：侧边栏字段placeholder提示

- **Given** 李经理在侧边栏看到空白的"优化目标"字段
- **When** 字段未输入
- **Then** 侧边栏显示灰色提示文字："做了之后要达到什么效果？例如：查询速度从5秒降至1秒"

#### AC4：侧边栏使用AI生成字段内容

- **Given** 李经理在侧边栏已填写部分字段
- **When** 点击侧边栏"🤖 AI辅助生成"按钮
- **Then** 系统调用deepseek/qwen大模型，基于已填写内容在侧边栏生成建议内容供参考

#### AC5：侧边栏通俗化术语表达

- **Given** 李经理查看侧边栏字段标签
- **When** 阅读字段名称
- **Then** 侧边栏使用通俗表达："为什么要做？"而非"需求背景"，"怎么判断解决了？"而非"验收标准"

### INVEST检查

| 原则                  | 检查项                        | 状态 |
| --------------------- | ----------------------------- | ---- |
| **I**ndependent | 可独立开发，不强依赖US-004    | ✅   |
| **N**egotiable  | 字段设计和引导文案可协商      | ✅   |
| **V**aluable    | 提供脚手架，需求完整度提升50% | ✅   |
| **E**stimable   | 团队估算2人天                 | ✅   |
| **S**mall       | 2人天，可在2天内完成          | ✅   |
| **T**estable    | 5条验收标准可转化为测试用例   | ✅   |

### 技术备注

- 侧边栏显示每个模板的字段配置，存储在JSON：`{"Bug反馈": {"fields": ["问题描述", "复现步骤", "预期结果"]}}`
- 引导问题和placeholder文案存储在配置文件
- 侧边栏AI生成功能调用deepseek/qwen API
- 用户在侧边栏填写完成后，点击"填充到ITSM"按钮，将所有字段拼接为Markdown格式后填充到ITSM描述框
- 字段验证：侧边栏必填字段未填时高亮提示

### 估算

- **工时**: 2人天
- **负责开发**: 开发B
- **依赖**: US-004（需要先有模板推荐）

---

## US-005：需求示例库降低门槛

### 故事描述

**As a** 一线业务员（小王），
**I want** 在侧边栏填写需求时，点击侧边栏"📋 查看示例"按钮查看2个高质量案例，
**So that** 我可以在侧边栏参考案例来写自己的需求，甚至直接一键填充到侧边栏字段后修改，降低描述门槛，3分钟完成填写。

### 故事背景

小王表示:"能不能给我一个例子？我照着写就行。"示例库是最好的教程，用户可以"抄作业"。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏显示示例入口

- **Given** 小王在侧边栏选择了"Bug反馈"模板
- **When** 模板加载完成
- **Then** 侧边栏顶部显示"📋 查看示例（2个）"按钮

#### AC2：侧边栏展示示例列表

- **Given** 小王点击侧边栏"查看示例"按钮
- **When** 点击完成
- **Then** 侧边栏展开示例区域，显示2个高质量示例，每个示例包含完整的背景/目标/场景/验收标准

#### AC3：侧边栏示例一键填充

- **Given** 小王在侧边栏查看示例1"客户查询性能优化"
- **When** 点击示例下方的"使用此示例"按钮
- **Then** 示例内容自动填充到侧边栏对应字段，小王可以在侧边栏修改后填充到ITSM

#### AC4：侧边栏示例区域收起保留内容

- **Given** 小王正在侧边栏查看示例
- **When** 点击示例区域的"收起"按钮
- **Then** 示例区域收起，侧边栏已填写的内容保留

### INVEST检查

| 原则                  | 检查项                        | 状态 |
| --------------------- | ----------------------------- | ---- |
| **I**ndependent | 可独立开发，不强依赖US-005    | ✅   |
| **N**egotiable  | 示例内容和展示方式可协商      | ✅   |
| **V**aluable    | 降低描述门槛，填写时间减少50% | ✅   |
| **E**stimable   | 团队估算1.5人天               | ✅   |
| **S**mall       | 1.5人天，可在2天内完成        | ✅   |
| **T**estable    | 4条验收标准可转化为测试用例   | ✅   |

### 技术备注

- 示例库存储在JSON文件：每个模板2个示例
- 示例结构：`{"title": "...", "background": "...", "goal": "...", "scenario": "...", "acceptance": "..."}`
- 侧边栏示例区域可收起/展开
- 一键填充功能：读取示例JSON并填充到侧边栏表单字段

### 估算

- **工时**: 1.5人天
- **负责开发**: 开发B
- **依赖**: 无

---

### 🎯 质量保障机制：实时检测与预防

---

## US-006：实时完整性检测提示

### 故事描述

**As a** 业务部门主管（李经理），
**I want** 在侧边栏填写需求过程中，侧边栏实时检测缺失的关键信息（如背景/目标/场景/验收标准），并在侧边栏高亮提示，
**So that** 我能边写边改，在点击"填充到ITSM"前就知道缺什么，避免提交后被退回，需求退回率从40%降至10%。

### 故事背景

李经理表示："我写完提交后才知道缺东西，已经来不及了。能不能边写边提示我，哪里还没写够？"实时检测是预防式设计的核心。

### 验收标准（Acceptance Criteria）

#### AC1：实时检测关键信息

- **Given** 李经理正在填写"功能优化"需求
- **When** 每输入50字或切换字段时
- **Then** 系统检测是否包含背景/目标/场景/验收标准的关键词，缺失的字段高亮显示（红色边框）

#### AC2：缺失信息具体提示

- **Given** 系统检测到"需求背景"字段缺失关键信息
- **When** 光标移到该字段
- **Then** 显示具体提示："该字段缺少'原因/问题/痛点'等关键词，建议补充"

#### AC3：检测防抖优化性能

- **Given** 李经理正在快速输入
- **When** 连续输入多个字符
- **Then** 检测使用防抖（debounce 500ms），避免频繁检测影响输入流畅度

#### AC4：字数统计辅助判断

- **Given** 李经理填写"使用场景"字段
- **When** 输入内容
- **Then** 实时显示字数统计："已输入32字（建议≥50字）"

#### AC5：检测规则可配置

- **Given** 不同模板有不同的检测规则
- **When** 切换模板
- **Then** 检测规则自动切换（如Bug反馈需要"复现步骤"，功能优化需要"当前问题"）

### INVEST检查

| 原则                  | 检查项                                      | 状态 |
| --------------------- | ------------------------------------------- | ---- |
| **I**ndependent | 可独立开发，不强依赖US-004和US-005          | ✅   |
| **N**egotiable  | 检测规则和关键词库可协商                    | ✅   |
| **V**aluable    | 边写边改，预防提交不合格需求，退回率降低75% | ✅   |
| **E**stimable   | 团队估算2人天                               | ✅   |
| **S**mall       | 2人天，可在2天内完成                        | ✅   |
| **T**estable    | 5条验收标准可转化为测试用例                 | ✅   |

### 技术备注

- 检测规则配置：{"功能优化": {"必含关键词": {"背景": ["问题", "痛点", "原因"], "目标": ["提升", "降低", "达到"]}}}
- 使用防抖（debounce 500ms）优化性能
- 高亮样式：CSS红色边框 + 感叹号图标
- 字数统计：实时计算字符长度

### 估算

- **工时**: 2人天
- **负责开发**: 开发A
- **依赖**: 无

---

## US-007：需求质量评分可视化

### 故事描述

**As a** 业务部门主管（李经理），
**I want** 在侧边栏填写需求过程中，侧边栏顶部实时显示需求质量评分（0-100分）和等级（优秀/良好/待改进），
**So that** 我能直观了解当前需求质量，建立提交信心，避免提交低质量需求被退回。

### 故事背景

李经理表示："我不知道自己写得够不够好，能不能给个分数让我心里有底？"质量评分是用户自我评估的工具，提供正向反馈。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏实时显示质量评分

- **Given** 李经理在侧边栏填写需求
- **When** 每填写完一个字段或输入50字以上
- **Then** 侧边栏顶部实时显示质量评分（如"需求质量：72分 - 良好"），评分基于完整性、字数、关键词覆盖度

#### AC2：侧边栏分级显示评分颜色

- **Given** 侧边栏计算出质量评分
- **When** 评分发生变化
- **Then** 侧边栏根据分数显示不同颜色：≥80分绿色"优秀"，60-79分黄色"良好"，<60分红色"待改进"

#### AC3：侧边栏评分细项展开

- **Given** 李经理查看侧边栏质量评分
- **When** 点击侧边栏评分旁的"📊 查看详情"按钮
- **Then** 侧边栏展开显示评分细项：完整性30分、字数充足度25分、关键词覆盖25分、逻辑清晰度20分

#### AC4：侧边栏低分提示改进建议

- **Given** 侧边栏评分<60分（红色"待改进"）
- **When** 李经理查看评分
- **Then** 侧边栏显示改进建议："建议补充'验收标准'字段（+15分）"

### INVEST检查

| 原则                  | 检查项                                           | 状态 |
| --------------------- | ------------------------------------------------ | ---- |
| **I**ndependent | 可独立开发，不强依赖US-007                       | ✅   |
| **N**egotiable  | 评分算法和权重可协商                             | ✅   |
| **V**aluable    | 建立用户信心，提供正向反馈，降低低质量需求提交率 | ✅   |
| **E**stimable   | 团队估算1.5人天                                  | ✅   |
| **S**mall       | 1.5人天，可在2天内完成                           | ✅   |
| **T**estable    | 4条验收标准可转化为测试用例                      | ✅   |

### 技术备注

- 评分算法：完整性30% + 字数充足度25% + 关键词覆盖25% + 逻辑清晰度20%
- 完整性：必填字段填写率（4个字段 × 7.5分）
- 字数充足度：各字段达到建议字数（50字）得分
- 关键词覆盖：基于检测规则的关键词命中率
- 逻辑清晰度：字段间连贯性（基础版可简化为固定20分）
- 侧边栏实时更新UI组件，使用防抖优化性能

### 估算

- **工时**: 1.5人天
- **负责开发**: 开发A
- **依赖**: 无

---

## US-008：提交前缺失警告预防

### 故事描述

**As a** 一线业务员（小王），
**I want** 在侧边栏点击"填充到ITSM"按钮前，侧边栏检查是否存在缺失或低质量内容，并弹出警告确认框，
**So that** 我能在最后关头确认一遍，避免提交不合格需求到ITSM后被退回，需求退回率从40%降至10%。

### 故事背景

小王表示："有时候太着急了，写完就点提交，后来才发现漏了东西。能不能提交前拦一下我？"提交前警告是最后一道防线。

### 验收标准（Acceptance Criteria）

#### AC1：侧边栏填充前检查必填字段

- **Given** 小王在侧边栏填写完需求，点击"填充到ITSM"按钮
- **When** 存在未填写的必填字段（背景/目标/场景/验收标准）
- **Then** 侧边栏弹出警告框："以下字段未填写：需求背景、验收标准。是否继续填充到ITSM？（取消/强制填充）"

#### AC2：侧边栏填充前检查质量评分

- **Given** 小王点击侧边栏"填充到ITSM"按钮
- **When** 侧边栏质量评分<60分（红色"待改进"）
- **Then** 侧边栏弹出警告框："当前需求质量评分52分（待改进），建议补充内容后再提交。是否继续？（取消/强制填充）"

#### AC3：侧边栏警告可选择强制填充

- **Given** 侧边栏弹出缺失警告
- **When** 小王点击"强制填充"按钮
- **Then** 忽略警告，将当前侧边栏内容拼接为Markdown格式后填充到ITSM描述框

#### AC4：侧边栏警告可选择返回修改

- **Given** 侧边栏弹出缺失警告
- **When** 小王点击"取消"按钮
- **Then** 关闭警告框，返回侧边栏继续编辑

#### AC5：侧边栏记录强制填充次数

- **Given** 小王选择"强制填充"忽略警告
- **When** 填充完成
- **Then** 系统记录强制填充行为到LocalStorage（timestamp, 忽略的警告类型），用于后续优化警告规则

### INVEST检查

| 原则                  | 检查项                               | 状态 |
| --------------------- | ------------------------------------ | ---- |
| **I**ndependent | 可独立开发，不强依赖US-007和US-008   | ✅   |
| **N**egotiable  | 警告触发条件和文案可协商             | ✅   |
| **V**aluable    | 提交前拦截，最后一道防线，降低退回率 | ✅   |
| **E**stimable   | 团队估算1人天                        | ✅   |
| **S**mall       | 1人天，可在1天内完成                 | ✅   |
| **T**estable    | 5条验收标准可转化为测试用例          | ✅   |

### 技术备注

- 侧边栏点击"填充到ITSM"按钮时触发检查
- 检查逻辑：必填字段验证 + 质量评分阈值检查
- 侧边栏警告框UI组件：Modal对话框
- 强制填充时将侧边栏所有字段拼接为Markdown格式：## 需求背景\n{背景内容}\n\n## 优化目标\n{目标内容}...
- 填充ITSM：使用 `document.querySelector('#descriptionTextarea').value = markdownContent`
- 行为记录到LocalStorage：`{timestamp, forcedSubmit: true, ignoredWarnings: ['missingFields', 'lowScore']}`

### 估算

- **工时**: 1人天
- **负责开发**: 开发B
- **依赖**: 无

---

## US-009：插件集成测试与部署

### 故事描述

**As a** 项目经理，
**I want** 对浏览器插件进行完整的集成测试（功能测试、兼容性测试、性能测试），并完成插件打包部署到Chrome/Edge应用商店，
**So that** 确保所有功能协同工作正常，用户可以顺利安装使用插件，实现P0功能的MVP交付目标。

### 故事背景

前9个Story完成了各个独立功能模块，US-010将这些模块集成为完整的浏览器插件，并进行端到端测试和部署。这是MVP交付的最后一步。

### 验收标准（Acceptance Criteria）

#### AC1：功能集成测试通过

- **Given** 所有P0功能模块（US-001至US-009）开发完成
- **When** 执行端到端测试场景：打开ITSM页面→侧边栏自动展开→系统分类选择→智能搜索→模板推荐→结构化填写→质量评分→填充到ITSM→提交
- **Then** 所有功能协同工作正常，无功能性Bug，关键路径100%可用

#### AC2：浏览器兼容性测试通过

- **Given** 插件需要支持Chrome 90+和Edge 90+
- **When** 分别在Chrome和Edge浏览器中安装插件并执行测试场景
- **Then** 两个浏览器均正常工作，侧边栏UI渲染正常，功能无差异

#### AC3：性能测试达标

- **Given** 性能要求：页面加载时间增加<500ms，内存占用<50MB，侧边栏交互响应<200ms
- **When** 使用Chrome DevTools进行性能分析
- **Then** 所有性能指标达标：页面加载增加300ms，内存占用35MB，侧边栏响应150ms

#### AC4：用户验收测试通过

- **Given** 邀请2名目标用户（李经理、小王）进行UAT测试
- **When** 用户执行真实需求提交场景（至少3个需求）
- **Then** 用户反馈满意度≥4分（5分制），无P0/P1级别问题

#### AC5：插件打包部署成功

- **Given** 所有测试通过，准备发布
- **When** 执行打包脚本，生成插件安装包（.crx或.zip）
- **Then** 插件安装包可在Chrome/Edge浏览器手动安装，所有功能正常（MVP阶段暂不上架应用商店）

### INVEST检查

| 原则                  | 检查项                        | 状态        |
| --------------------- | ----------------------------- | ----------- |
| **I**ndependent | 依赖US-001至US-009全部完成    | ⚠️ 有依赖 |
| **N**egotiable  | 测试用例和验收标准可协商      | ✅          |
| **V**aluable    | 确保MVP整体质量，交付可用产品 | ✅          |
| **E**stimable   | 团队估算2人天                 | ✅          |
| **S**mall       | 2人天，可在2-3天内完成        | ✅          |
| **T**estable    | 5条验收标准可转化为测试用例   | ✅          |

### 技术备注

- **集成测试工具**: Selenium或Puppeteer进行端到端自动化测试
- **兼容性测试**: BrowserStack或手动测试Chrome 90+和Edge 90+
- **性能测试**: Chrome DevTools Lighthouse + Performance面板
- **插件打包**: 使用 `npm run build`生成dist目录，压缩为.zip或.crx
- **manifest.json配置**: 确保 `permissions: ["storage", "activeTab", "scripting"]`，`content_scripts`指向ITSM域名
- **部署方式**: MVP阶段手动安装（开发者模式加载未打包的扩展程序），后续可上架Chrome Web Store

### 测试场景清单

#### 场景1：完整需求提交流程（Happy Path）

`markdown

1. 用户打开ITSM需求提交页面
2. 侧边栏自动展开，显示系统分类
3. 用户点击"客户管理"分类，选择"CRM系统"并填充到ITSM
4. 用户在ITSM标题输入"客户查询很慢"
5. 侧边栏监听到输入，推荐"Bug反馈"模板（匹配度85%）
6. 用户点击"使用模板"，侧边栏展开结构化字段
7. 用户填写：问题描述、复现步骤、预期结果
8. 侧边栏实时显示质量评分：78分（良好）
9. 用户点击"填充到ITSM"，内容拼接为Markdown填充到ITSM描述框
10. 用户在ITSM点击"提交"，需求成功提交
    `

#### 场景2：低质量需求警告（Sad Path）

`markdown

1. 用户打开ITSM页面，侧边栏展开
2. 用户选择系统但信心度选"不确定"，侧边栏推荐备选系统
3. 用户在ITSM标题简单输入"优化"
4. 侧边栏推荐"功能优化"模板
5. 用户只填写"优化目标"字段（50字），其他字段留空
6. 侧边栏质量评分：42分（待改进），缺失字段高亮红色
7. 用户点击"填充到ITSM"
8. 侧边栏弹出警告："缺失字段：需求背景、使用场景、验收标准，质量评分42分。是否继续？"
9. 用户点击"取消"，返回侧边栏补充内容
10. 补充后质量评分提升至68分，成功填充到ITSM
    `

#### 场景3：示例库快速填写（Power User）

`markdown

1. 用户打开ITSM页面
2. 用户在侧边栏搜索框输入"kehu"（拼音搜索）
3. 侧边栏显示匹配系统：客户关系管理系统
4. 用户点击选择并填充到ITSM
5. 用户在ITSM标题输入"导出功能"
6. 侧边栏推荐"新功能"模板
7. 用户点击"📋 查看示例"，展开2个示例
8. 用户点击示例1"客户数据导出Excel"的"使用此示例"
9. 侧边栏字段自动填充示例内容
10. 用户略作修改，质量评分85分（优秀）
11. 一键填充到ITSM，成功提交
    `

### 估算

- **工时**: 2人天
  - Day1上午：集成测试环境搭建 + 自动化测试脚本编写
  - Day1下午：功能集成测试 + Bug修复
  - Day2上午：兼容性测试 + 性能测试 + UAT测试
  - Day2下午：插件打包 + 部署验证 + 文档整理
- **负责人**: 开发A + 开发B
- **依赖**: US-001至US-008全部完成

---

## 📋 第3章：故事依赖关系图

### 3.1 依赖关系表

| Story编号 | 前置依赖         | 后置依赖       | 依赖说明                               |
| --------- | ---------------- | -------------- | -------------------------------------- |
| US-001    | 无               | US-002         | 系统智能搜索是信心度反馈的前置功能     |
| US-002    | US-001           | 无             | 需要先有系统选择功能才能进行信心度反馈 |
| US-003    | 无               | US-004         | 模板推荐是结构化填写的前置功能         |
| US-004    | US-003（弱依赖） | US-005, US-006 | 可以独立开发，但有模板后更完整         |
| US-005    | 无               | 无             | 示例库独立功能                         |
| US-006    | US-004（弱依赖） | US-007         | 检测规则依赖字段定义                   |
| US-007    | US-006（弱依赖） | US-008         | 质量评分基于检测结果                   |
| US-008    | US-006, US-007   | US-009         | 警告依赖检测和评分功能                 |
| US-009    | US-001至US-008   | 无             | 集成测试依赖所有功能完成               |

### 3.2 依赖关系可视化

`
┌─────────────────────────────────────────────────────────────┐
│                   第一层：系统选择（Day 2-3）                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐                                                │
│  │ US-001   │                                                │
│  │ 智能搜索 │                                                │
│  │ 与选择   │                                                │
│  └────┬─────┘                                                │
│       │                                                      │
│       ▼                                                      │
│  ┌──────────┐                                                │
│  │ US-002   │                                                │
│  │ 信心度   │                                                │
│  │ 反馈     │                                                │
│  └──────────┘                                                │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│               第二层：需求填写引导（Day 2-4）                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐                                                │
│  │ US-003   │                                                │
│  │ 模板推荐 │                                                │
│  └────┬─────┘                                                │
│       │  （弱依赖）                                          │
│       ▼                                                      │
│  ┌──────────┐      ┌──────────┐                             │
│  │ US-004   │      │ US-005   │                             │
│  │ 结构化   │      │ 示例库   │                             │
│  │ 引导     │      │          │                             │
│  └────┬─────┘      └──────────┘                             │
│       │  （弱依赖）                                          │
│       ▼                                                      │
│  ┌──────────┐                                                │
│  │ US-006   │                                                │
│  │ 实时检测 │                                                │
│  └────┬─────┘                                                │
│       │  （弱依赖）                                          │
│       ▼                                                      │
│  ┌──────────┐                                                │
│  │ US-007   │                                                │
│  │ 质量评分 │                                                │
│  └────┬─────┘                                                │
│       │                                                      │
│       ▼                                                      │
│  ┌──────────┐                                                │
│  │ US-008   │                                                │
│  │ 提交警告 │                                                │
│  └────┬─────┘                                                │
│       │                                                      │
└───────┼─────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────┐
│              第三层：集成测试部署（Day 6-8）                   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│            ┌─────────────┐                                  │
│            │  US-009     │                                  │
│            │  集成测试   │                                  │
│            │  与部署     │                                  │
│            └─────────────┘                                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
`

### 3.3 并行开发建议

#### 第一组（Day 2-3）：系统选择模块

- **开发A**: US-001（系统智能搜索与选择）
- **开发B**: US-002（信心度反馈） + US-003（模板推荐）

**并行理由**: US-001是核心功能，开发A专注完成；US-002需等待US-001完成后集成测试；US-003独立开发。

#### 第二组（Day 3-5）：需求填写模块

- **开发A**: US-006（实时检测） + US-007（质量评分）
- **开发B**: US-004（结构化引导） + US-005（示例库） + US-008（提交警告）

**并行理由**: US-004和US-006虽有弱依赖，但可以通过Mock数据解耦并行开发。

#### 第三组（Day 6-8）：集成测试

- **开发A + 开发B**: US-009（集成测试与部署）

**并行理由**: 集成测试需要两人协作完成。

---

## 📋 第4章：故事拆分说明

### 4.1 为什么US-009不继续拆分？

US-009（集成测试与部署）虽然涉及多个测试类型（功能测试、兼容性测试、性能测试、UAT测试、打包部署），但**不应继续拆分**，理由如下：

#### 理由1：集成测试是整体性活动

- 功能测试、兼容性测试、性能测试是**顺序执行**的测试活动，拆分后会增加协调成本
- 拆分为US-009A（功能测试）、US-009B（兼容性测试）后，US-009B必须等待US-009A完成，**无法并行**

#### 理由2：估算合理（2人天）

- US-009估算2人天（16小时），符合INVEST原则的"Small"标准（<3人天）
- 拆分后每个子Story可能只有0.5-1人天，**过于细碎**，增加管理开销

#### 理由3：业务价值不可分割

- US-009的业务价值是"交付可用的MVP插件"，这是一个**整体目标**
- 拆分为"通过功能测试"和"通过性能测试"后，**单个子Story无法独立交付价值**

#### 反面案例：过度拆分的问题

如果继续拆分：

`❌ US-009A：功能集成测试（1人天） ❌ US-009B：兼容性测试（0.5人天） ❌ US-009C：性能测试（0.5人天） ❌ US-009D：用户验收测试（0.5人天） ❌ US-009E：插件打包部署（0.5人天）`

问题：

1. US-009B至US-009E**强依赖**US-009A，无法并行
2. 每个Story估算<1人天，**过于细碎**
3. 5个Story需要5次计划会议、5次评审、5次验收，**管理成本高**

### 4.2 其他Story的拆分考虑

#### US-004（结构化引导）为什么不拆分？

US-004虽然包含5个AC（显示字段、引导问题、placeholder、AI生成、通俗化术语），但：

- 5个AC是**同一个功能的不同方面**（结构化引导的完整实现）
- 估算2人天，符合"Small"标准
- 拆分后会破坏功能的完整性（如只有字段显示没有引导问题，用户体验不完整）

#### US-009的正确姿态：按测试阶段组织AC

US-009的5个AC已经很好地组织为：

1. **AC1**: 功能集成测试（核心）
2. **AC2**: 兼容性测试（质量保障）
3. **AC3**: 性能测试（质量保障）
4. **AC4**: 用户验收测试（业务验证）
5. **AC5**: 插件打包部署（交付）

这5个AC按**测试流程**组织，形成一个完整的测试-部署闭环，**无需拆分**。

### 4.3 Story拆分的黄金法则

#### 法则1：INVEST原则优先

- **I**ndependent（独立）：拆分后的Story能独立开发、测试、部署
- **N**egotiable（可协商）：实现细节可协商，不强制技术方案
- **V**aluable（有价值）：**每个Story必须能独立交付业务价值**
- **E**stimable（可估算）：团队能估算工作量（1-3人天为佳）
- **S**mall（小）：<3人天，可在1-2个迭代内完成
- **T**estable（可测试）：AC可转化为明确的测试用例

#### 法则2：避免"纵向切割"（按技术层拆分）

❌ **错误示例**：
`US-005A：前端结构化字段UI开发 US-005B：后端引导文案配置 US-005C：AI生成API集成`

问题：单个Story无法独立交付价值（前端UI没有数据无法使用）

✅ **正确示例**：
`
US-005：结构化引导填写需求（2人天）

- AC1：显示结构化字段
- AC2：字段引导问题
- AC3：placeholder提示
- AC4：AI辅助生成
- AC5：通俗化术语表达
  `

#### 法则3：避免"过度拆分"

- 估算<0.5人天的Story通常**过于细碎**
- 如果一个Story的AC<3个，可能是**拆分过度**
- 如果拆分后的Story之间有**强依赖**（必须顺序执行），说明拆分不合理

#### 法则4：按"用户价值"拆分，而非"技术任务"

✅ **正确拆分**（按用户场景）：
`US-001：系统分类导航快速定位 US-002：系统智能搜索快速查找 US-003：系统选择信心度反馈`

每个Story解决一个**用户痛点**，独立交付价值。

❌ **错误拆分**（按技术任务）：
`US-001：侧边栏UI框架搭建 US-002：系统数据JSON配置 US-003：分类算法实现`

单个Story无法独立交付用户价值。

---

## ✅ 文档总结

本文档基于《需求痛点.md》《用户旅程分析报告.md》《创新方案评估报告.md》，将ITSM系统需求提交优化需求转化为10个符合INVEST原则的用户故事：

### 核心架构修正

**关键调整**: 所有Story从"在ITSM页面注入UI"修正为"浏览器插件侧边栏交互模式"

- ✅ **正确交互流程**: ITSM页面打开 → 侧边栏自动展开 → 用户在侧边栏操作 → 点击"填充到ITSM" → 内容填充到ITSM表单value
- ❌ **错误理解**: 在ITSM页面DOM中注入按钮、修改下拉框、高亮字段（违反只读约束）

### Story分布

- **P0核心功能（9个Story）**: US-001至US-009，总计15.5人天
- **P0集成测试（1个Story）**: US-010，总计2人天
- **总计**: 10个Story，17.5人天（符合20人天约束，留2.5天Buffer）

### 依赖关系

- **第一层（系统选择）**: US-001 → US-002 → US-003
- **第二层（需求填写）**: US-004 → US-005 → US-006 → US-007 → US-008 → US-009
- **第三层（集成测试）**: US-010（依赖所有前置Story）

### 关键技术约束

- 浏览器插件（Chrome/Edge 90+）
- **侧边栏UI为主交互界面，ITSM系统只读**
- deepseek/qwen大模型API（模板推荐、AI生成）
- LocalStorage（数据持久化）
- 无后端服务

### 下一步行动

1. **技术评审**: 架构师评审侧边栏交互方案的可行性
2. **Story评审**: Product Owner确认Story优先级和验收标准
3. **迭代规划**: 按Day2-3、Day4-5、Day6-8三个阶段排期
4. **开发启动**: 开发A/B并行开发US-001至US-004

---

**📌 文档版本**: v2.0 - 架构修正版（侧边栏交互模式）
**📅 最后更新**: 2025年12月8日
**👥 编写人**: AI助手
**✅ 状态**: 已完成，待评审
