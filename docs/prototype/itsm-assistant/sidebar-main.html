<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITSMéœ€æ±‚åŠ©æ‰‹ - ä¾§è¾¹æ ä¸»ç•Œé¢</title>
    <style>
        /* ========== å…¨å±€æ ·å¼ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #262626;
            background: #f0f2f5;
        }

        /* ========== ä¾§è¾¹æ å®¹å™¨ ========== */
        .sidebar {
            width: 380px;
            height: 100vh;
            overflow-y: auto;
            background: #f5f5f5;
            padding: 16px;
        }

        /* ========== é¡¶éƒ¨å¯¼èˆª ========== */
        .header {
            background: #ffffff;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: #1890ff;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #f5f5f5;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: #e6f7ff;
            color: #1890ff;
        }

        /* ========== åŒºå—å®¹å™¨ ========== */
        .section {
            background: #ffffff;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #262626;
        }

        /* ========== ç³»ç»Ÿé€‰æ‹©åŒºåŸŸ ========== */
        .search-box {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }

        .system-selected {
            padding: 12px;
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 4px;
            color: #1890ff;
            margin-bottom: 12px;
            display: none;
        }

        .system-selected.active {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .link-button {
            color: #1890ff;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
            padding: 0;
        }

        .link-button:hover {
            color: #40a9ff;
        }

        .confidence-selector {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: #fff7e6;
            border: 1px solid #ffd591;
            border-radius: 4px;
        }

        .confidence-selector.active {
            display: block;
        }

        .confidence-label {
            font-size: 13px;
            color: #8c8c8c;
            margin-bottom: 8px;
        }

        .confidence-buttons {
            display: flex;
            gap: 8px;
        }

        .confidence-btn {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            background: #ffffff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .confidence-btn:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        .confidence-btn.selected {
            background: #1890ff;
            color: #ffffff;
            border-color: #1890ff;
        }

        /* ========== æ¨¡æ¿æ¨èåŒºåŸŸ ========== */
        .template-card {
            padding: 12px;
            background: #fff7e6;
            border: 1px solid #ffd591;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .template-title {
            font-size: 14px;
            font-weight: 600;
            color: #262626;
        }

        .template-confidence {
            font-size: 12px;
            color: #fa8c16;
        }

        .template-reason {
            font-size: 13px;
            color: #8c8c8c;
            margin-bottom: 8px;
        }

        .template-apply-btn {
            width: 100%;
            padding: 6px;
            background: #1890ff;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .template-apply-btn:hover {
            background: #40a9ff;
        }

        .template-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .template-tab {
            padding: 6px 16px;
            border: 1px solid #d9d9d9;
            background: #ffffff;
            border-radius: 16px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .template-tab:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        .template-tab.active {
            background: #1890ff;
            color: #ffffff;
            border-color: #1890ff;
        }

        /* ========== è¡¨å•å­—æ®µåŒºåŸŸ ========== */
        .form-field {
            margin-bottom: 16px;
        }

        .form-label {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: #262626;
        }

        .required {
            color: #f5222d;
            margin-right: 4px;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }

        .form-input.error {
            border-color: #f5222d;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-hint {
            font-size: 12px;
            color: #8c8c8c;
            margin-top: 4px;
        }

        .form-error {
            font-size: 12px;
            color: #f5222d;
            margin-top: 4px;
            display: none;
        }

        .form-error.active {
            display: block;
        }

        .example-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #1890ff;
            font-size: 13px;
            cursor: pointer;
            margin-top: 8px;
        }

        .example-link:hover {
            color: #40a9ff;
        }

        /* ========== è´¨é‡è¯„åˆ†åŒºåŸŸ ========== */
        .quality-card {
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: #ffffff;
            margin-bottom: 16px;
        }

        .quality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .quality-score {
            font-size: 32px;
            font-weight: 700;
        }

        .quality-stars {
            font-size: 18px;
        }

        .quality-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .quality-progress-bar {
            height: 100%;
            background: #ffffff;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .quality-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .quality-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .quality-details.active {
            display: block;
        }

        .quality-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .quality-item-bar {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 12px;
            overflow: hidden;
        }

        .quality-item-fill {
            height: 100%;
            background: #ffffff;
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .toggle-details {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }

        .toggle-details:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ========== æ“ä½œæŒ‰é’®åŒºåŸŸ ========== */
        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn-primary {
            flex: 1;
            padding: 10px;
            background: #1890ff;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #40a9ff;
            box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
        }

        .btn-primary:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }

        .btn-primary.loading {
            position: relative;
            color: transparent;
        }

        .btn-primary.loading::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn-secondary {
            padding: 10px 20px;
            background: #ffffff;
            color: #262626;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        /* ========== æç¤ºæ¶ˆæ¯ ========== */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: #ffffff;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.active {
            display: flex;
        }

        .toast.success {
            border-left: 4px solid #52c41a;
        }

        .toast.error {
            border-left: 4px solid #f5222d;
        }

        .toast.warning {
            border-left: 4px solid #faad14;
        }

        .toast-icon {
            font-size: 18px;
        }

        .toast.success .toast-icon {
            color: #52c41a;
        }

        .toast.error .toast-icon {
            color: #f5222d;
        }

        .toast.warning .toast-icon {
            color: #faad14;
        }

        /* ========== è­¦å‘Šå¯¹è¯æ¡† ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #ffffff;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #262626;
        }

        .modal-content {
            font-size: 14px;
            color: #595959;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .missing-list {
            margin: 8px 0;
            padding-left: 20px;
        }

        .missing-list li {
            color: #f5222d;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div class="header-title">ğŸ“‹ ITSMéœ€æ±‚åŠ©æ‰‹</div>
            <div class="header-actions">
                <button class="icon-btn" title="å†å²è®°å½•" onclick="showToast('åŠŸèƒ½å¼€å‘ä¸­', 'warning')">ğŸ“œ</button>
                <button class="icon-btn" title="è‰ç¨¿" onclick="showToast('åŠŸèƒ½å¼€å‘ä¸­', 'warning')">ğŸ’¾</button>
                <button class="icon-btn" title="è®¾ç½®" onclick="showToast('åŠŸèƒ½å¼€å‘ä¸­', 'warning')">âš™ï¸</button>
            </div>
        </div>

        <!-- ç³»ç»Ÿé€‰æ‹©åŒºåŸŸ -->
        <div class="section" id="systemSection">
            <div class="section-title">1ï¸âƒ£ é€‰æ‹©ç›®æ ‡ç³»ç»Ÿ</div>
            
            <!-- æœç´¢æ¡† -->
            <input 
                type="text" 
                class="search-box" 
                id="systemSearch" 
                placeholder="ğŸ” æœç´¢ç³»ç»Ÿï¼ˆæ”¯æŒæ‹¼éŸ³ï¼‰ä¾‹å¦‚ï¼šCRMã€khgl"
                oninput="handleSystemSearch()"
            />
            
            <!-- å·²é€‰æ‹©ç³»ç»Ÿ -->
            <div class="system-selected" id="systemSelected">
                <span id="selectedSystemName">âœ… å·²é€‰æ‹©ï¼šCRMå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</span>
                <button class="link-button" onclick="clearSystemSelection()">é‡æ–°é€‰æ‹©</button>
            </div>
            
            <!-- åˆ†ç±»å¯¼èˆªé“¾æ¥ -->
            <button class="link-button" onclick="window.location.href='page-category.html'">
                ğŸ“‚ ä¸ç¡®å®šï¼Ÿæµè§ˆåˆ†ç±»
            </button>
            
            <!-- ä¿¡å¿ƒåº¦é€‰æ‹© -->
            <div class="confidence-selector" id="confidenceSelector">
                <div class="confidence-label">æ‚¨å¯¹è¿™ä¸ªé€‰æ‹©æœ‰å¤šç¡®å®šï¼Ÿ</div>
                <div class="confidence-buttons">
                    <button class="confidence-btn" onclick="selectConfidence('uncertain')">ä¸ç¡®å®š</button>
                    <button class="confidence-btn" onclick="selectConfidence('normal')">ä¸€èˆ¬</button>
                    <button class="confidence-btn" onclick="selectConfidence('certain')">ç¡®å®š</button>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ¿æ¨èåŒºåŸŸ -->
        <div class="section" id="templateSection">
            <div class="section-title">2ï¸âƒ£ éœ€æ±‚ç±»å‹</div>
            
            <!-- æ™ºèƒ½æ¨èå¡ç‰‡ -->
            <div class="template-card" id="templateRecommend" style="display: none;">
                <div class="template-header">
                    <div class="template-title">ğŸ’¡ æ¨èï¼šBugåé¦ˆæ¨¡æ¿</div>
                    <div class="template-confidence">ç½®ä¿¡åº¦ 85%</div>
                </div>
                <div class="template-reason" id="recommendReason">
                    æ£€æµ‹åˆ°å…³é”®è¯"æ…¢"ï¼Œæ¨èä½¿ç”¨Bugåé¦ˆæ¨¡æ¿
                </div>
                <button class="template-apply-btn" onclick="applyTemplate('bug')">åº”ç”¨æ­¤æ¨¡æ¿</button>
            </div>
            
            <!-- æ‰‹åŠ¨é€‰æ‹©æ ‡ç­¾ -->
            <div class="template-tabs">
                <button class="template-tab active" data-template="bug" onclick="switchTemplate('bug')">
                    ğŸ› Bugåé¦ˆ
                </button>
                <button class="template-tab" data-template="optimize" onclick="switchTemplate('optimize')">
                    âš¡ åŠŸèƒ½ä¼˜åŒ–
                </button>
                <button class="template-tab" data-template="feature" onclick="switchTemplate('feature')">
                    âœ¨ æ–°åŠŸèƒ½
                </button>
            </div>
        </div>

        <!-- ç»“æ„åŒ–è¡¨å•åŒºåŸŸ -->
        <div class="section" id="formSection">
            <div class="section-title">3ï¸âƒ£ å¡«å†™éœ€æ±‚å†…å®¹</div>
            
            <!-- éœ€æ±‚æ ‡é¢˜ -->
            <div class="form-field">
                <label class="form-label">
                    <span class="required">*</span>
                    éœ€æ±‚æ ‡é¢˜
                </label>
                <input 
                    type="text" 
                    class="form-input" 
                    id="requirementTitle"
                    placeholder="ä¾‹å¦‚ï¼šCRMå®¢æˆ·æŸ¥è¯¢å“åº”å¾ˆæ…¢"
                    oninput="handleTitleInput()"
                    maxlength="100"
                />
                <div class="form-hint">ç®€æ˜æ‰¼è¦ï¼Œ10-100å­—</div>
                <div class="form-error" id="titleError">æ ‡é¢˜é•¿åº¦éœ€è¦10-100å­—</div>
            </div>
            
            <!-- éœ€æ±‚èƒŒæ™¯ -->
            <div class="form-field">
                <label class="form-label">
                    <span class="required">*</span>
                    éœ€æ±‚èƒŒæ™¯
                </label>
                <textarea 
                    class="form-input form-textarea" 
                    id="requirementBackground"
                    placeholder="ä¸ºä»€ä¹ˆè¦åšï¼Ÿé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå½±å“èŒƒå›´æœ‰å¤šå¤§ï¼Ÿ
ä¾‹å¦‚ï¼šå®¢æœå›¢é˜Ÿåé¦ˆï¼Œåœ¨CRMç³»ç»ŸæŸ¥è¯¢å®¢æˆ·ä¿¡æ¯æ—¶ï¼Œé¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡10ç§’ï¼Œå½±å“100+å®¢æœæ—¥å¸¸å·¥ä½œæ•ˆç‡ã€‚"
                    oninput="handleContentChange()"
                ></textarea>
                <div class="form-hint">æè¿°é—®é¢˜èƒŒæ™¯å’Œå½±å“ï¼Œå»ºè®®50-500å­—</div>
                <div class="form-error" id="backgroundError">èƒŒæ™¯æè¿°ä¸èƒ½å°‘äº50å­—</div>
            </div>
            
            <!-- éœ€æ±‚ç›®æ ‡ -->
            <div class="form-field">
                <label class="form-label">
                    <span class="required">*</span>
                    éœ€æ±‚ç›®æ ‡
                </label>
                <textarea 
                    class="form-input form-textarea" 
                    id="requirementGoal"
                    placeholder="åšäº†ä¹‹åè¦è¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿæœ‰ä»€ä¹ˆå…·ä½“æŒ‡æ ‡ï¼Ÿ
ä¾‹å¦‚ï¼šä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼Œå°†å®¢æˆ·ä¿¡æ¯æŸ¥è¯¢å“åº”æ—¶é—´ä»10ç§’é™ä½åˆ°3ç§’ä»¥å†…ï¼Œæå‡å®¢æœå·¥ä½œæ•ˆç‡ã€‚"
                    oninput="handleContentChange()"
                ></textarea>
                <div class="form-hint">æ˜ç¡®é¢„æœŸæ•ˆæœå’Œé‡åŒ–æŒ‡æ ‡ï¼Œå»ºè®®20-300å­—</div>
                <div class="form-error" id="goalError">ç›®æ ‡æè¿°ä¸èƒ½å°‘äº20å­—</div>
            </div>
            
            <!-- ä½¿ç”¨åœºæ™¯ -->
            <div class="form-field">
                <label class="form-label">
                    <span class="required">*</span>
                    ä½¿ç”¨åœºæ™¯
                </label>
                <textarea 
                    class="form-input form-textarea" 
                    id="requirementScenario"
                    placeholder="è°åœ¨ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°ï¼Ÿå…¸å‹æ“ä½œæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ
ä¾‹å¦‚ï¼šå®¢æœäººå‘˜åœ¨æ¥å¬å®¢æˆ·ç”µè¯æ—¶ï¼Œéœ€è¦å¿«é€ŸæŸ¥è¯¢å®¢æˆ·å†å²è®¢å•ã€æŠ•è¯‰è®°å½•ç­‰ä¿¡æ¯ï¼Œæ¯å¤©æ“ä½œé¢‘ç‡çº¦50æ¬¡/äººã€‚"
                    oninput="handleContentChange()"
                ></textarea>
                <div class="form-hint">æè¿°å…¸å‹ä½¿ç”¨åœºæ™¯å’Œé¢‘æ¬¡ï¼Œå»ºè®®30-400å­—</div>
                <div class="form-error" id="scenarioError">åœºæ™¯æè¿°ä¸èƒ½å°‘äº30å­—</div>
            </div>
            
            <!-- éªŒæ”¶æ ‡å‡† -->
            <div class="form-field">
                <label class="form-label">
                    <span class="required">*</span>
                    éªŒæ”¶æ ‡å‡†
                </label>
                <textarea 
                    class="form-input form-textarea" 
                    id="requirementAcceptance"
                    placeholder="æ€ä¹ˆåˆ¤æ–­é—®é¢˜è§£å†³äº†ï¼Ÿæœ‰ä»€ä¹ˆå…·ä½“çš„éªŒæ”¶æ¡ä»¶ï¼Ÿ
ä¾‹å¦‚ï¼š
1. å®¢æˆ·ä¿¡æ¯æŸ¥è¯¢å“åº”æ—¶é—´P95 < 3ç§’
2. åœ¨1000æ¡æ•°æ®ä¸‹ä»èƒ½ä¿æŒæ€§èƒ½
3. æ— æ–°å¢Bugï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½"
                    oninput="handleContentChange()"
                ></textarea>
                <div class="form-hint">æ˜ç¡®éªŒæ”¶æ¡ä»¶å’Œæµ‹è¯•æ ‡å‡†ï¼Œå»ºè®®20-300å­—</div>
                <div class="form-error" id="acceptanceError">éªŒæ”¶æ ‡å‡†ä¸èƒ½å°‘äº20å­—</div>
            </div>
            
            <!-- æŸ¥çœ‹ç¤ºä¾‹é“¾æ¥ -->
            <div class="example-link" onclick="window.location.href='page-examples.html'">
                ğŸ“š æŸ¥çœ‹ä¼˜ç§€éœ€æ±‚ç¤ºä¾‹
            </div>
        </div>

        <!-- è´¨é‡è¯„åˆ†åŒºåŸŸ -->
        <div class="quality-card" id="qualityCard">
            <div class="quality-header">
                <div>
                    <div class="quality-score" id="qualityScore">0</div>
                    <div class="quality-label">éœ€æ±‚è´¨é‡è¯„åˆ†</div>
                </div>
                <div class="quality-stars" id="qualityStars">â˜†â˜†â˜†â˜†â˜†</div>
            </div>
            <div class="quality-progress">
                <div class="quality-progress-bar" id="qualityProgressBar" style="width: 0%"></div>
            </div>
            <button class="toggle-details" onclick="toggleQualityDetails()">
                æŸ¥çœ‹è¯„åˆ†è¯¦æƒ…
            </button>
            
            <div class="quality-details" id="qualityDetails">
                <div class="quality-item">
                    <span>å®Œæ•´æ€§</span>
                    <div class="quality-item-bar">
                        <div class="quality-item-fill" id="scoreComplete" style="width: 0%"></div>
                    </div>
                    <span id="scoreCompleteText">0/25</span>
                </div>
                <div class="quality-item">
                    <span>å­—æ•°</span>
                    <div class="quality-item-bar">
                        <div class="quality-item-fill" id="scoreWordCount" style="width: 0%"></div>
                    </div>
                    <span id="scoreWordCountText">0/30</span>
                </div>
                <div class="quality-item">
                    <span>å…³é”®è¯</span>
                    <div class="quality-item-bar">
                        <div class="quality-item-fill" id="scoreKeyword" style="width: 0%"></div>
                    </div>
                    <span id="scoreKeywordText">0/20</span>
                </div>
                <div class="quality-item">
                    <span>åœºæ™¯æè¿°</span>
                    <div class="quality-item-bar">
                        <div class="quality-item-fill" id="scoreScenario" style="width: 0%"></div>
                    </div>
                    <span id="scoreScenarioText">0/15</span>
                </div>
                <div class="quality-item">
                    <span>éªŒæ”¶æ ‡å‡†</span>
                    <div class="quality-item-bar">
                        <div class="quality-item-fill" id="scoreAcceptance" style="width: 0%"></div>
                    </div>
                    <span id="scoreAcceptanceText">0/10</span>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
        <div class="section">
            <div class="action-buttons">
                <button class="btn-secondary" onclick="resetForm()">é‡ç½®</button>
                <button class="btn-primary" id="submitBtn" onclick="handleSubmit()">
                    å¡«å……åˆ°ITSM
                </button>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast">
        <span class="toast-icon" id="toastIcon">âœ“</span>
        <span id="toastMessage">æ“ä½œæˆåŠŸ</span>
    </div>

    <!-- è­¦å‘Šå¯¹è¯æ¡† -->
    <div class="modal-overlay" id="warningModal">
        <div class="modal">
            <div class="modal-title">âš ï¸ éœ€æ±‚è´¨é‡åä½</div>
            <div class="modal-content">
                <p>å½“å‰éœ€æ±‚è´¨é‡è¯„åˆ†ï¼š<strong id="modalScore">45</strong>åˆ†</p>
                <p>æ£€æµ‹åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p>
                <ul class="missing-list" id="missingList">
                    <li>éœ€æ±‚èƒŒæ™¯å­—æ•°ä¸è¶³</li>
                    <li>ç¼ºå°‘é‡åŒ–æŒ‡æ ‡</li>
                </ul>
                <p>å»ºè®®è¡¥å……å®Œæ•´åå†æäº¤ï¼Œè¿™æ ·èƒ½æé«˜éœ€æ±‚è¢«ç†è§£å’Œå®ç°çš„æ¦‚ç‡ã€‚</p>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeWarningModal()">è¿”å›ä¿®æ”¹</button>
                <button class="btn-primary" onclick="forceSubmit()">å¼ºåˆ¶å¡«å……</button>
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€çŠ¶æ€ ==========
        const state = {
            selectedSystem: null,
            confidence: null,
            currentTemplate: 'bug',
            formData: {
                title: '',
                background: '',
                goal: '',
                scenario: '',
                acceptance: ''
            },
            qualityScore: 0,
            qualityDetails: {
                complete: 0,
                wordCount: 0,
                keyword: 0,
                scenario: 0,
                acceptance: 0
            }
        };

        // æ¨¡æ‹Ÿç³»ç»Ÿæ•°æ®åº“
        const systemDatabase = [
            { id: 'SYS001', name: 'CRMå®¢æˆ·ç®¡ç†ç³»ç»Ÿ', pinyin: 'khgl', category: 'å®¢æˆ·ç±»' },
            { id: 'SYS002', name: 'è®¡è´¹ç³»ç»Ÿ', pinyin: 'jfxt', category: 'è®¡è´¹ç±»' },
            { id: 'SYS003', name: 'ç½‘ç»œç›‘æ§å¹³å°', pinyin: 'wljkpt', category: 'ç½‘ç»œç±»' }
        ];

        // ========== ç³»ç»Ÿé€‰æ‹©åŠŸèƒ½ ==========
        let searchTimeout;
        function handleSystemSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const keyword = document.getElementById('systemSearch').value.toLowerCase();
                if (keyword.length > 0) {
                    // æ¨¡æ‹Ÿæœç´¢ï¼ˆå®é™…åº”å±•ç¤ºä¸‹æ‹‰åˆ—è¡¨ï¼‰
                    if (keyword.includes('crm') || keyword.includes('khgl')) {
                        selectSystem('SYS001', 'CRMå®¢æˆ·ç®¡ç†ç³»ç»Ÿ');
                    }
                }
            }, 200);
        }

        function selectSystem(id, name) {
            state.selectedSystem = { id, name };
            document.getElementById('selectedSystemName').textContent = `âœ… å·²é€‰æ‹©ï¼š${name}`;
            document.getElementById('systemSelected').classList.add('active');
            document.getElementById('confidenceSelector').classList.add('active');
            document.getElementById('systemSearch').value = '';
        }

        function clearSystemSelection() {
            state.selectedSystem = null;
            state.confidence = null;
            document.getElementById('systemSelected').classList.remove('active');
            document.getElementById('confidenceSelector').classList.remove('active');
            document.querySelectorAll('.confidence-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        function selectConfidence(level) {
            state.confidence = level;
            document.querySelectorAll('.confidence-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            if (level === 'uncertain') {
                showToast('å»ºè®®æµè§ˆç³»ç»Ÿåˆ†ç±»ï¼Œæˆ–æŸ¥çœ‹ç³»ç»ŸåŠŸèƒ½è¯´æ˜', 'warning');
            } else {
                showToast('å·²è®°å½•æ‚¨çš„é€‰æ‹©', 'success');
                // è‡ªåŠ¨æ»šåŠ¨åˆ°æ¨¡æ¿åŒº
                document.getElementById('templateSection').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ========== æ¨¡æ¿æ¨èåŠŸèƒ½ ==========
        let titleTimeout;
        function handleTitleInput() {
            const title = document.getElementById('requirementTitle').value;
            state.formData.title = title;
            
            // æ ‡é¢˜éªŒè¯
            if (title.length > 0 && title.length < 10) {
                document.getElementById('titleError').classList.add('active');
                document.getElementById('requirementTitle').classList.add('error');
            } else {
                document.getElementById('titleError').classList.remove('active');
                document.getElementById('requirementTitle').classList.remove('error');
            }
            
            // æ™ºèƒ½æ¨èï¼ˆé˜²æŠ–ï¼‰
            clearTimeout(titleTimeout);
            titleTimeout = setTimeout(() => {
                const bugKeywords = ['æ…¢', 'å¡', 'æŠ¥é”™', 'å¤±è´¥', 'å¼‚å¸¸', 'é—®é¢˜', 'bug'];
                const optimizeKeywords = ['ä¼˜åŒ–', 'æ”¹è¿›', 'æå‡', 'é™ä½'];
                const featureKeywords = ['æ–°å¢', 'å¢åŠ ', 'å¼€å‘', 'åŠŸèƒ½'];
                
                let recommendType = null;
                let confidence = 0;
                let reason = '';
                
                if (bugKeywords.some(kw => title.includes(kw))) {
                    recommendType = 'bug';
                    confidence = 85;
                    reason = `æ£€æµ‹åˆ°å…³é”®è¯"${bugKeywords.find(kw => title.includes(kw))}"ï¼Œæ¨èä½¿ç”¨Bugåé¦ˆæ¨¡æ¿`;
                } else if (optimizeKeywords.some(kw => title.includes(kw))) {
                    recommendType = 'optimize';
                    confidence = 78;
                    reason = `æ£€æµ‹åˆ°å…³é”®è¯"${optimizeKeywords.find(kw => title.includes(kw))}"ï¼Œæ¨èä½¿ç”¨åŠŸèƒ½ä¼˜åŒ–æ¨¡æ¿`;
                } else if (featureKeywords.some(kw => title.includes(kw))) {
                    recommendType = 'feature';
                    confidence = 72;
                    reason = `æ£€æµ‹åˆ°å…³é”®è¯"${featureKeywords.find(kw => title.includes(kw))}"ï¼Œæ¨èä½¿ç”¨æ–°åŠŸèƒ½æ¨¡æ¿`;
                }
                
                if (recommendType && confidence >= 70) {
                    document.getElementById('templateRecommend').style.display = 'block';
                    document.getElementById('recommendReason').textContent = reason;
                    document.querySelector('.template-confidence').textContent = `ç½®ä¿¡åº¦ ${confidence}%`;
                }
            }, 300);
            
            calculateQuality();
        }

        function switchTemplate(type) {
            state.currentTemplate = type;
            document.querySelectorAll('.template-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const templates = {
                bug: 'ğŸ› Bugåé¦ˆ',
                optimize: 'âš¡ åŠŸèƒ½ä¼˜åŒ–',
                feature: 'âœ¨ æ–°åŠŸèƒ½'
            };
            showToast(`å·²åˆ‡æ¢åˆ°"${templates[type]}"æ¨¡æ¿`, 'success');
        }

        function applyTemplate(type) {
            switchTemplate(type);
            document.getElementById('templateRecommend').style.display = 'none';
            document.getElementById('formSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ========== è¡¨å•å†…å®¹å˜åŒ–å¤„ç† ==========
        let contentTimeout;
        function handleContentChange() {
            state.formData.background = document.getElementById('requirementBackground').value;
            state.formData.goal = document.getElementById('requirementGoal').value;
            state.formData.scenario = document.getElementById('requirementScenario').value;
            state.formData.acceptance = document.getElementById('requirementAcceptance').value;
            
            // å­—æ®µéªŒè¯
            validateField('background', 50);
            validateField('goal', 20);
            validateField('scenario', 30);
            validateField('acceptance', 20);
            
            // å®æ—¶è´¨é‡æ£€æµ‹ï¼ˆé˜²æŠ–ï¼‰
            clearTimeout(contentTimeout);
            contentTimeout = setTimeout(() => {
                calculateQuality();
            }, 500);
        }

        function validateField(fieldName, minLength) {
            const value = state.formData[fieldName];
            const errorEl = document.getElementById(`${fieldName}Error`);
            const inputEl = document.getElementById(`requirement${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)}`);
            
            if (value.length > 0 && value.length < minLength) {
                errorEl.classList.add('active');
                inputEl.classList.add('error');
            } else {
                errorEl.classList.remove('active');
                inputEl.classList.remove('error');
            }
        }

        // ========== è´¨é‡è¯„åˆ†è®¡ç®— ==========
        function calculateQuality() {
            let totalScore = 0;
            const details = { complete: 0, wordCount: 0, keyword: 0, scenario: 0, acceptance: 0 };
            
            // 1. å®Œæ•´æ€§è¯„åˆ†ï¼ˆ25åˆ†ï¼‰
            const filledFields = [
                state.formData.title,
                state.formData.background,
                state.formData.goal,
                state.formData.scenario,
                state.formData.acceptance
            ].filter(f => f.trim().length > 0).length;
            
            const completeScores = { 5: 25, 4: 20, 3: 12, 2: 6, 1: 2, 0: 0 };
            details.complete = completeScores[filledFields] || 0;
            
            // 2. å­—æ•°è¯„åˆ†ï¼ˆ30åˆ†ï¼‰
            const wordCounts = {
                background: Math.min(state.formData.background.length * 0.6, 30),
                goal: Math.min(state.formData.goal.length * 1.25, 25),
                scenario: Math.min(state.formData.scenario.length * 0.83, 25),
                acceptance: Math.min(state.formData.acceptance.length, 20)
            };
            details.wordCount = Math.round(Object.values(wordCounts).reduce((a, b) => a + b, 0) * 0.3);
            
            // 3. å…³é”®è¯è¯„åˆ†ï¼ˆ20åˆ†ï¼‰
            const allText = Object.values(state.formData).join(' ');
            let keywordScore = 0;
            if (/å®¢æœ|ç”¨æˆ·|å®¢æˆ·|å‘˜å·¥|ç®¡ç†å‘˜/.test(allText)) keywordScore += 5;
            if (/\d+[ç§’åˆ†é’Ÿå°æ—¶å¤©]|\d+%|P\d+/.test(allText)) keywordScore += 5;
            if (/å¡é¡¿|æ…¢|æŠ¥é”™|å¤±è´¥|å¼‚å¸¸|é—®é¢˜/.test(allText)) keywordScore += 5;
            if (/æå‡|é™ä½|ä¼˜åŒ–|æ”¹è¿›|å¢åŠ |å‡å°‘/.test(allText)) keywordScore += 5;
            details.keyword = keywordScore;
            
            // 4. åœºæ™¯æè¿°è¯„åˆ†ï¼ˆ15åˆ†ï¼‰
            const scenarioText = state.formData.scenario;
            let scenarioScore = 0;
            if (scenarioText.length >= 30) scenarioScore += 5;
            if (/è°|ä»€ä¹ˆæ—¶å€™|é¢‘ç‡|æ¬¡æ•°/.test(scenarioText)) scenarioScore += 5;
            if (/\d+/.test(scenarioText)) scenarioScore += 5;
            details.scenario = scenarioScore;
            
            // 5. éªŒæ”¶æ ‡å‡†è¯„åˆ†ï¼ˆ10åˆ†ï¼‰
            const acceptanceText = state.formData.acceptance;
            let acceptanceScore = 0;
            if (acceptanceText.length >= 20) acceptanceScore += 3;
            if (/\d+/.test(acceptanceText)) acceptanceScore += 4;
            if (/1\.|2\.|3\./.test(acceptanceText)) acceptanceScore += 3;
            details.acceptance = acceptanceScore;
            
            // æ€»åˆ†
            totalScore = details.complete + details.wordCount + details.keyword + details.scenario + details.acceptance;
            totalScore = Math.min(Math.round(totalScore), 100);
            
            state.qualityScore = totalScore;
            state.qualityDetails = details;
            
            updateQualityDisplay();
        }

        function updateQualityDisplay() {
            const score = state.qualityScore;
            
            // æ›´æ–°åˆ†æ•°
            document.getElementById('qualityScore').textContent = score;
            document.getElementById('qualityProgressBar').style.width = score + '%';
            
            // æ›´æ–°æ˜Ÿçº§
            const stars = Math.round(score / 20);
            document.getElementById('qualityStars').textContent = 'â˜…'.repeat(stars) + 'â˜†'.repeat(5 - stars);
            
            // æ›´æ–°é¢œè‰²
            const card = document.getElementById('qualityCard');
            if (score >= 80) {
                card.style.background = 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)';
            } else if (score >= 60) {
                card.style.background = 'linear-gradient(135deg, #faad14 0%, #d48806 100%)';
            } else {
                card.style.background = 'linear-gradient(135deg, #f5222d 0%, #cf1322 100%)';
            }
            
            // æ›´æ–°è¯¦æƒ…
            const details = state.qualityDetails;
            updateDetailBar('scoreComplete', details.complete, 25);
            updateDetailBar('scoreWordCount', details.wordCount, 30);
            updateDetailBar('scoreKeyword', details.keyword, 20);
            updateDetailBar('scoreScenario', details.scenario, 15);
            updateDetailBar('scoreAcceptance', details.acceptance, 10);
        }

        function updateDetailBar(id, score, maxScore) {
            const percent = (score / maxScore) * 100;
            document.getElementById(id).style.width = percent + '%';
            document.getElementById(id + 'Text').textContent = `${score}/${maxScore}`;
        }

        function toggleQualityDetails() {
            const details = document.getElementById('qualityDetails');
            details.classList.toggle('active');
            event.target.textContent = details.classList.contains('active') ? 'æ”¶èµ·è¯¦æƒ…' : 'æŸ¥çœ‹è¯„åˆ†è¯¦æƒ…';
        }

        // ========== æäº¤å¤„ç† ==========
        function handleSubmit() {
            // æ£€æŸ¥å¿…å¡«é¡¹
            if (!state.selectedSystem) {
                showToast('è¯·å…ˆé€‰æ‹©ç›®æ ‡ç³»ç»Ÿ', 'error');
                return;
            }
            
            if (!state.formData.title || state.formData.title.length < 10) {
                showToast('è¯·å¡«å†™éœ€æ±‚æ ‡é¢˜ï¼ˆè‡³å°‘10å­—ï¼‰', 'error');
                return;
            }
            
            // è´¨é‡æ£€æŸ¥
            if (state.qualityScore < 60) {
                showWarningModal();
                return;
            }
            
            // æ‰§è¡Œå¡«å……
            doSubmit();
        }

        function showWarningModal() {
            const missingItems = [];
            if (state.formData.background.length < 50) missingItems.push('éœ€æ±‚èƒŒæ™¯å­—æ•°ä¸è¶³ï¼ˆéœ€è¦â‰¥50å­—ï¼‰');
            if (state.formData.goal.length < 20) missingItems.push('éœ€æ±‚ç›®æ ‡å­—æ•°ä¸è¶³ï¼ˆéœ€è¦â‰¥20å­—ï¼‰');
            if (state.formData.scenario.length < 30) missingItems.push('ä½¿ç”¨åœºæ™¯å­—æ•°ä¸è¶³ï¼ˆéœ€è¦â‰¥30å­—ï¼‰');
            if (state.formData.acceptance.length < 20) missingItems.push('éªŒæ”¶æ ‡å‡†å­—æ•°ä¸è¶³ï¼ˆéœ€è¦â‰¥20å­—ï¼‰');
            if (!/\d+/.test(state.formData.goal)) missingItems.push('ç¼ºå°‘é‡åŒ–æŒ‡æ ‡');
            
            document.getElementById('modalScore').textContent = state.qualityScore;
            document.getElementById('missingList').innerHTML = missingItems.map(item => `<li>${item}</li>`).join('');
            document.getElementById('warningModal').classList.add('active');
        }

        function closeWarningModal() {
            document.getElementById('warningModal').classList.remove('active');
        }

        function forceSubmit() {
            closeWarningModal();
            doSubmit();
        }

        function doSubmit() {
            const btn = document.getElementById('submitBtn');
            btn.classList.add('loading');
            btn.disabled = true;
            
            setTimeout(() => {
                // æ¨¡æ‹Ÿå¡«å……åˆ°ITSM
                const markdown = `
ã€éœ€æ±‚èƒŒæ™¯ã€‘
${state.formData.background}

ã€éœ€æ±‚ç›®æ ‡ã€‘
${state.formData.goal}

ã€ä½¿ç”¨åœºæ™¯ã€‘
${state.formData.scenario}

ã€éªŒæ”¶æ ‡å‡†ã€‘
${state.formData.acceptance}
                `.trim();
                
                console.log('å¡«å……å†…å®¹ï¼š', {
                    system: state.selectedSystem,
                    title: state.formData.title,
                    description: markdown
                });
                
                // ä¿å­˜åˆ°localStorage
                const history = JSON.parse(localStorage.getItem('itsm_history') || '[]');
                history.unshift({
                    id: Date.now(),
                    system: state.selectedSystem,
                    title: state.formData.title,
                    content: state.formData,
                    score: state.qualityScore,
                    createTime: new Date().toISOString(),
                    status: 'å·²å¡«å……'
                });
                localStorage.setItem('itsm_history', JSON.stringify(history));
                
                btn.classList.remove('loading');
                btn.disabled = false;
                showToast('âœ… å†…å®¹å·²å¡«å……åˆ°ITSMï¼Œè¯·æ£€æŸ¥åæäº¤', 'success');
            }, 1000);
        }

        function resetForm() {
            if (!confirm('ç¡®å®šè¦é‡ç½®è¡¨å•å—ï¼Ÿæ‰€æœ‰å†…å®¹å°†è¢«æ¸…ç©ºã€‚')) {
                return;
            }
            
            state.formData = {
                title: '',
                background: '',
                goal: '',
                scenario: '',
                acceptance: ''
            };
            
            document.getElementById('requirementTitle').value = '';
            document.getElementById('requirementBackground').value = '';
            document.getElementById('requirementGoal').value = '';
            document.getElementById('requirementScenario').value = '';
            document.getElementById('requirementAcceptance').value = '';
            
            calculateQuality();
            showToast('è¡¨å•å·²é‡ç½®', 'success');
        }

        // ========== æç¤ºæ¶ˆæ¯ ==========
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const messageEl = document.getElementById('toastMessage');
            
            toast.className = `toast ${type} active`;
            messageEl.textContent = message;
            
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                warning: 'âš '
            };
            icon.textContent = icons[type] || 'âœ“';
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', () => {
            // æ¨¡æ‹Ÿå·²é€‰æ‹©ç³»ç»Ÿï¼ˆæµ‹è¯•ç”¨ï¼‰
            selectSystem('SYS001', 'CRMå®¢æˆ·ç®¡ç†ç³»ç»Ÿ');
            selectConfidence('certain');
            
            // åˆå§‹åŒ–è´¨é‡è¯„åˆ†
            calculateQuality();
        });
    </script>
</body>
</html>
